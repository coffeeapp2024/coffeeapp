(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[743],{6051:function(e,t,n){Promise.resolve().then(n.bind(n,506))},506:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(7437),o=n(703),c=n(8792),a=n(2265),s=function(){return(0,r.jsx)("div",{className:"fixed bottom-10 w-screen max-w-screen-sm z-10 shadow-sm px-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center justify-center px-3 py-2 w-fit mx-auto bg-white bg-opacity-90 rounded-3xl border-[1px] border-neutral-300 divide-neutral-300  divide-x-[1px]",children:[(0,r.jsx)(c.default,{href:"/home",children:(0,r.jsxs)("div",{className:"nav-item",children:[(0,r.jsx)(o.default,{src:"/icons/navbar/home.png",width:200,height:200,className:"nav-icon scale-[1.2]",alt:"Home Icon"}),(0,r.jsx)("span",{className:"nav-item-name",children:"Home"})]})}),(0,r.jsx)(c.default,{href:"/shop",className:"",children:(0,r.jsxs)("div",{className:"nav-item",children:[(0,r.jsx)(o.default,{src:"/icons/navbar/shop.png",width:200,height:200,className:"nav-icon",alt:"Shop Icon"}),(0,r.jsx)("span",{className:"nav-item-name",children:"Shop"})]})}),(0,r.jsx)(c.default,{href:"/",children:(0,r.jsxs)("div",{className:"nav-item",children:[(0,r.jsx)(o.default,{src:"/icons/navbar/mine.png",width:200,height:200,alt:"Mine Icon",className:"nav-icon"}),(0,r.jsx)("span",{className:"nav-item-name",children:"Mine"})]})}),(0,r.jsx)(c.default,{href:"/gift",children:(0,r.jsxs)("div",{className:"nav-item",children:[(0,r.jsx)("div",{className:"relative ",children:(0,r.jsx)(o.default,{src:"/icons/navbar/game.png",width:200,height:200,className:"nav-icon",alt:"Gift Icon"})}),(0,r.jsx)("span",{className:"nav-item-name",children:"Gift"})]})})]})})},i=n(4499),l=n(6885),u=n(8884),d=n(3053),f=n(8121),h=n(6288);function m(e){let{setPosts:t,posts:n,name:r}=e;(0,a.useEffect)(()=>{(async()=>{try{if(!r||n.length>0)return;let e=await (0,l.YA)(r);e.length>0&&0===n.length?(t(e),console.log("Fetched and set post images from Firestore for collection ".concat(r,"."))):console.log("No post images found for collection ".concat(r,"."))}catch(e){console.error("Error fetching post images for collection ".concat(r,":"),e)}})()},[])}function g(e){let{children:t}=e,{userData:n,userId:o,setRole:c,setUserData:g,setUserId:p}=(0,u.bL)(),{setCurrentCoin:y,currentCoin:w}=(0,u.Kk)(),{banner:v,setBanner:E}=(0,u.MB)();(0,a.useEffect)(()=>{if(!n||!o){let e=i.I8.onAuthStateChanged(async e=>{if(e&&e.email)try{let t=await (0,l.FQ)(e.uid),n=(await (0,f.QT)((0,f.JU)((0,f.hJ)(i.db,"admin"),"accounts"))).data();console.log("Fetched Account:",n);let{staff:r,manager:o,testing:a}=n,s=a?"manager":(null==r?void 0:r.includes(e.email))?"staff":(null==o?void 0:o.includes(e.email))?"manager":null;console.log("user role:",s),c(s),p(e.uid),a&&t&&(t.coin+=100,h.A.info("Testing Mode! +100 coin"),console.log("Testing Mode! +100 coin")),console.log("fetchedUserData:",t),g(t),console.log("Login successfully")}catch(e){console.error("Error fetching user data:",e)}else g(null)});return()=>e()}},[n,o,g,p,c]),(0,a.useEffect)(()=>{let{balance:e,coin:t,startTimeMine:r}=null!=n?n:{};if(e&&t){let n=(0,d.g6)(e,t,r);y(n),console.log("initialCurrentCoin:",n)}},[y,n]),(0,a.useEffect)(()=>{(async()=>{try{if(!v){let e=await (0,l.Yh)();E(e)}}catch(e){console.error("Error fetching shop content:",e)}})()}),m((0,u.U)()),m((0,u.ny)()),function(){let{setVouchers:e,vouchers:t}=(0,u.Ep)();(0,a.useEffect)(()=>{t||(async()=>{try{let t=await (0,l.wY)();e(t),console.log("Voucher fetched")}catch(e){console.error("Error fetching vouchers:",e)}})()},[e,t])}(),function(){let{setCases:e,cases:t}=(0,u.Ur)();(0,a.useEffect)(()=>{t||(async()=>{try{let t=await (0,l.XX)();e(t),console.log("Cases fetched")}catch(e){console.error("Error fetching cases:",e)}})()},[e,t])}(),function(){let{setLevels:e,levels:t}=(0,u.Q6)();(0,a.useEffect)(()=>{t||(async()=>{try{let t=await (0,l.x4)();e(t),console.log("Levels fetched")}catch(e){console.error("Error fetching levels:",e)}})()},[e,t])}(),function(){let{productTags:e,setProductTags:t}=(0,u.Bv)();(0,a.useEffect)(()=>{(async()=>{try{if(!e){let e=await (0,l.FG)();t(e),console.log("Fetched product tags from Firestore:",e)}}catch(e){console.error("Error fetching product tags:",e)}})()},[e,t])}(),function(){let{products:e,setProducts:t}=(0,u.aD)();(0,a.useEffect)(()=>{(async()=>{try{if(!e){let e=await (0,l.vL)();t(e),console.log("Fetched products from Firestore:",e)}}catch(e){console.error("Error fetching products:",e)}})()},[t])}();let{minePageContent:b,setMinePageContent:x}=(0,u.dk)();(0,a.useEffect)(()=>{b||(0,f.QT)((0,f.JU)((0,f.hJ)(i.db,"contents"),"minePage")).then(e=>{let t=e.data();console.log("Fetched minePageContent:",t),x(t)})},[b,x]);let{homePageContent:U,setHomePageContent:I}=(0,u.xE)();return(0,a.useEffect)(()=>{U||(0,f.QT)((0,f.JU)((0,f.hJ)(i.db,"contents"),"homepage")).then(e=>{let t=e.data();console.log("Fetched HomePageContent:",t),I(t)})},[U,I]),(0,r.jsxs)("main",{className:"relative mx-auto w-full",children:[(0,r.jsx)(s,{}),t]})}},3053:function(e,t,n){"use strict";function r(e,t,n){let r=new Date,o=n?new Date(n):null;return o&&r<o?t+e/3600:t}function o(e,t,n){let r=new Date,o=n?new Date(n):null;return o&&e&&r>o?parseFloat((t+(r.getTime()-o.getTime())/1e3/3600*e).toFixed(5)):t}n.d(t,{DE:function(){return c},Dx:function(){return r},g6:function(){return o}});let c=async(e,t)=>{let n=36e5*t,{balance:r,coin:c,startTimeMine:a,endTimeMine:s}=e;if(!r||!c)return;let i=new Date,l=s?new Date(s):null,u=l&&l>i?new Date(l.getTime()+n).toISOString():new Date(Date.now()+n).toISOString(),d=await o(r,c,a);return{...e,coin:d,startTimeMine:i.toISOString(),endTimeMine:u}}},4499:function(e,t,n){"use strict";n.d(t,{Ap:function(){return l},I8:function(){return i},db:function(){return u},tO:function(){return d}});var r=n(6142),o=n(8121),c=n(2730),a=n(4905);let s=(0,r.ZF)({apiKey:"AIzaSyC5L-FI5QWb_uDeUdEbeSEmpMwAr9P8ze4",authDomain:"coffee-coin-app.firebaseapp.com",projectId:"coffee-coin-app",storageBucket:"coffee-coin-app.appspot.com",messagingSenderId:"53756991092",appId:"1:53756991092:web:abb9e522247df5f0f6e321",measurementId:"G-PV6MFHBST4"}),i=(0,c.v0)(s),l=new c.hJ,u=(0,o.ad)(s),d=(0,a.cF)(s)},6885:function(e,t,n){"use strict";n.d(t,{FG:function(){return F},FQ:function(){return g},Pv:function(){return p},XX:function(){return b},YA:function(){return L},Yh:function(){return T},a4:function(){return N},ck:function(){return w},n8:function(){return v},t7:function(){return y},uL:function(){return m},vL:function(){return J},vV:function(){return j},vz:function(){return k},wY:function(){return E},x4:function(){return x},zS:function(){return U}});var r=n(8121),o=n(4499),c=n(4905);let a=(0,r.hJ)(o.db,"users"),s=(0,r.hJ)(o.db,"contents"),i=(0,r.hJ)(o.db,"keys"),l=(0,r.hJ)(o.db,"vouchers"),u=(0,r.hJ)(o.db,"game_random_voucher"),d=(0,r.hJ)(o.db,"levels"),f=(0,r.hJ)(o.db,"products"),h=(0,r.hJ)(o.db,"productTags");async function m(e){let t=(0,r.JU)(a,e.uid);try{if((await (0,r.QT)(t)).exists()||!e.email||!e.displayName)return console.error("User data already exists or user data is incomplete"),null;{let n={email:e.email,displayName:e.displayName,coin:0,balance:.1,startTimeMine:null,endTimeMine:null,voucherIdList:[],LikedEventImageIdList:[],LikedCheckinImageIdList:[]};return await (0,r.pl)(t,n),n}}catch(e){throw console.error("Error creating user data:",e),e}}async function g(e){let t=(0,r.JU)(a,e);try{let e=await (0,r.QT)(t);if(e.exists())return e.data();return console.log("User data not found"),null}catch(e){throw console.error("Error fetching user data:",e),e}}async function p(e,t){let n=(0,r.JU)(a,e);try{await (0,r.pl)(n,t,{merge:!0}),console.log("User data updated successfully")}catch(e){throw console.error("Error updating user data:",e),e}}async function y(e){let t=[];try{for(let n=0;n<e;n++){let e=(0,r.JU)(i),n=e.id;await (0,r.pl)(e,{key:n}),t.push(n)}return t}catch(e){throw console.error("Error generating and saving keys:",e),e}}async function w(){try{let e=await (0,r.PL)(i),t=[];return e.forEach(e=>{let n=e.id;t.push(n)}),t}catch(e){throw console.error("Error fetching keys from Firestore:",e),e}}async function v(e){try{await (0,r.oe)((0,r.JU)(i,e)),console.log("Key deleted successfully:",e)}catch(e){throw console.error("Error deleting key from Firestore:",e),e}}async function E(){try{let e=await (0,r.PL)(l),t=[];return e.forEach(e=>{t.push({id:e.id,...e.data()})}),t}catch(e){throw console.error("Error fetching vouchers from Firestore:",e),e}}async function b(){try{let e=await (0,r.PL)(u),t=[];return e.forEach(e=>{t.push({id:e.id,...e.data()})}),t}catch(e){throw console.error("Error fetching cases from Firestore:",e),e}}async function x(){try{let e=await (0,r.PL)(d),t=[];return e.forEach(e=>{t.push({id:e.id,...e.data()})}),t}catch(e){throw console.error("Error fetching levels from Firestore:",e),e}}function U(e,t){let n=(0,r.JU)(a,e);try{return(0,r.cf)(n,e=>{if(e.exists()){let n=e.data().voucherIdList||[];t(n)}else console.log("User data not found")})}catch(e){throw console.error("Error listening for voucherIdList changes:",e),e}}async function I(e,t){try{let n=(0,c.iH)(o.tO,"".concat(t,"/").concat(e.name)),r=await (0,c.B0)(n,e);return await (0,c.Jt)(r.ref)}catch(e){throw console.error("Error uploading image to Firebase Storage:",e),e}}async function N(e,t,n,c){try{let a=await I(e,c);return{id:(await (0,r.ET)((0,r.hJ)(o.db,c),{userEmail:n,userId:t,imageURL:a,likedNumber:0})).id,userEmail:n,userId:t,imageURL:a,likedNumber:0}}catch(e){throw console.error("Error uploading image and adding to collection:",e),e}}async function k(e,t,n){try{if(!e){console.error("Error updating liked number: ID is empty");return}let c=(0,r.JU)((0,r.hJ)(o.db,n),e);await (0,r.r7)(c,{likedNumber:t}),console.log("Liked number updated successfully.")}catch(e){throw console.error("Error updating liked number:",e),e}}async function L(e){try{let t=await (0,r.PL)((0,r.hJ)(o.db,e)),n=[];return t.forEach(e=>{var t,r,o,c;let a=e.data(),s={id:e.id,userEmail:null!==(t=a.userEmail)&&void 0!==t?t:null,userId:null!==(r=a.userId)&&void 0!==r?r:null,imageURL:null!==(o=a.imageURL)&&void 0!==o?o:null,likedNumber:null!==(c=a.likedNumber)&&void 0!==c?c:0};n.push(s)}),n}catch(e){throw console.error("Error fetching post images:",e),e}}async function J(){try{let e=await (0,r.PL)(f),t=[];return e.forEach(e=>{let n=e.data(),r={id:e.id,img:n.img,name:n.name,price:n.price,tags:n.tags};t.push(r)}),t}catch(e){throw console.error("Error fetching products from Firestore:",e),e}}async function F(){try{let e=await (0,r.PL)(h),t=[];return e.forEach(e=>{let n=e.data();if(n.name&&n.tag){let e={name:n.name,tag:n.tag};t.push(e)}}),t}catch(e){throw console.error("Error fetching product tags from Firestore:",e),e}}async function T(){try{let e=await (0,r.QT)((0,r.JU)(s,"shopPage"));if(!e.exists())return console.log("Document 'shop' does not exist"),null;{let t=e.data(),n=null==t?void 0:t.banner;if(n)return console.log("Banner fetched"),n;return console.log("Banner not found in shop content"),null}}catch(e){throw console.error("Error fetching shop content:",e),e}}async function j(e,t,n){try{let o=(0,r.JU)(a,e),c=await (0,r.QT)(o);if(c.exists()){let{voucherIdList:r}=c.data();if(!r||n>=r.length)throw Error("Invalid index or missing voucherIdList");r.splice(n,1),await p(e,{voucherIdList:r}),console.log("Voucher ID ".concat(t," deleted successfully from user ").concat(e))}else console.log("User ".concat(e," not found"))}catch(e){throw console.error("Error deleting voucher ID from user:",e),e}}},8792:function(e,t,n){"use strict";n.d(t,{default:function(){return o.a}});var r=n(5250),o=n.n(r)},8884:function(e,t,n){"use strict";n.d(t,{Bv:function(){return g},Ep:function(){return i},Kk:function(){return s},MB:function(){return p},OX:function(){return y},Q6:function(){return u},U:function(){return f},Uc:function(){return a},Ur:function(){return l},aD:function(){return m},bL:function(){return o},dk:function(){return v},jc:function(){return w},ny:function(){return h},xE:function(){return c}});var r=n(2020);let o=(0,r.Ue)(e=>({userData:null,userId:null,role:null,setUserData:t=>e({userData:t}),setUserId:t=>e({userId:t}),setRole:t=>e({role:t})})),c=(0,r.Ue)(e=>({homePageContent:null,setHomePageContent:t=>e({homePageContent:t})})),a=(0,r.Ue)(e=>({remainingTimeSeconds:null,setRemainingTimeSeconds:t=>e({remainingTimeSeconds:t})})),s=(0,r.Ue)(e=>({currentCoin:null,setCurrentCoin:t=>e({currentCoin:t})})),i=(0,r.Ue)(e=>({vouchers:null,setVouchers:t=>e({vouchers:t})})),l=(0,r.Ue)(e=>({cases:null,setCases:t=>e({cases:[...t]})})),u=(0,r.Ue)(e=>({levels:null,setLevels:t=>e({levels:t})}));function d(e,t){return(0,r.Ue)(n=>({name:e,posts:t,setName:e=>n({name:e}),setPosts:e=>n({posts:e}),addPost:async e=>{n(t=>({posts:[e,...t.posts]}))},setLikedNumber:async(e,t)=>{let r;return n(n=>{var o;let c=n.posts.map(n=>{var r;return n.id===e?{...n,likedNumber:(null!==(r=n.likedNumber)&&void 0!==r?r:0)+(t?1:-1)}:n});return r=null===(o=c.find(t=>t.id===e))||void 0===o?void 0:o.likedNumber,{...n,posts:c}}),null!=r?r:0}}))}let f=d("eventImages",[]),h=d("checkinImages",[]),m=(0,r.Ue)(e=>({products:null,setProducts:t=>e({products:t})})),g=(0,r.Ue)(e=>({productTags:null,currentTag:"all",setProductTags:t=>e({productTags:t}),setCurrentTag:t=>e({currentTag:t})})),p=(0,r.Ue)(e=>({banner:null,setBanner:t=>e({banner:t})})),y=(0,r.Ue)(e=>({randomVoucherId:null,open:!1,setRandomVoucherId:t=>e({randomVoucherId:t}),setOpen:t=>e({open:t})})),w=(0,r.Ue)(e=>({voucherId:null,index:null,open:!1,setVoucherId:t=>e({voucherId:t}),setIndex:t=>e({index:t}),setOpen:t=>e({open:t})})),v=(0,r.Ue)(e=>({minePageContent:null,setMinePageContent:t=>e({minePageContent:t})}))}},function(e){e.O(0,[358,124,199,288,703,250,971,69,744],function(){return e(e.s=6051)}),_N_E=e.O()}]);